
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Logging Test Failures in a PhantomJS QUnit Runner - TJ VanToll's Blog - Tutorials, Thoughts, and Ramblings on Front-End Development</title>
  <meta name="author" content="TJ VanToll">

  
  <meta name="description" content="PhantomJS provides an easy means of automating QUnit tests; it even provides a test runner that you can simply copy into your project to run them. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tjvantoll.com/2012/08/22/logging-test-failures-in-a-phantomjs-qunit-runner">
  <link rel="author" href="https://plus.google.com/+TJVanToll">

  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
  
  <!--Custom script concatenation
  <script src="/javascripts/modernizr-2.5.3.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js"></script>
  <script src="/javascripts/PictureCube.js"></script>
  <script src="/javascripts/blog.js"></script>
  -->
  <script src="/javascripts/build/scripts.js"></script>

  <link href="/atom.xml" rel="alternate" title="TJ VanToll's Blog" type="application/atom+xml">
  
  <script type="text/javascript">
  	if (window.location.host.indexOf('local') == -1) {
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-29179796-1']);
	    _gaq.push(['_trackPageview']);
	
	    (function() {
	      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	    })();
    }
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
	<h1><a href="/">TJ VanToll's Blog</a></h1>
	
		<h2>Tutorials, Thoughts, and Ramblings on Front-End Development</h2> 
	
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tjvantoll.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
<li><a href="/">About</a></li>
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="/speaking/">Speaking</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article itemscope itemtype="http://schema.org/BlogPosting" role="article">
  
  <header>
    
      <h1 class="entry-title" itemprop="name headline">Logging Test Failures in a PhantomJS QUnit Runner</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-22T00:00:00-04:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="http://phantomjs.com">PhantomJS</a> provides an easy means of automating <a href="http://qunitjs.com">QUnit</a> tests; it even provides a <a href="https://github.com/ariya/phantomjs/blob/master/examples/run-qunit.js">test runner</a> that you can simply copy into your project to run them.</p>

<p>The output of said runner displays the number of tests ran and the number that passed.  For example, here&#8217;s an example of the output when I use the default runner on jQuery UI&#8217;s spinner test suite:</p>

<pre class="language-shell"><code>tj-cpu:spinner tj$ phantomjs run-qunit.js spinner.html
Tests completed in 492 milliseconds
489 tests of 489 passed, 0 failed.
'waitFor()' finished in 587ms.
</code></pre>


<p>Which is great, but if something fails you only get the following:</p>

<pre class="language-shell"><code>tj-cpu:myproject tj$ phantomjs run-qunit.js spinner.html
'waitFor()' finished in 630ms.
Tests completed in 535 milliseconds.
486 tests of 489 passed, 3 failed.
</code></pre>


<p>The provided runner doesn&#8217;t provide any additional information about the tests that failed.  Luckily PhantomJS and QUnit make it trivial to customize the output to meet your needs.</p>

<!--more-->


<h3>Logging</h3>

<p>PhantomJS&#8217;s <a href="http://code.google.com/p/phantomjs/wiki/Interface#onConsoleMessage">page.onConsoleMessage</a> callback can be used to redirect the browser&#8217;s JavaScript console logging.  The provided test runner uses this callback to redirect the output to the command line instead of the headless browser (where you would never see it).</p>

<pre class="language-javascript"><code>// Route "console.log()" calls from within the Page context to the main Phantom context (i.e. current "this")
page.onConsoleMessage = function(msg) {
    console.log(msg);
};
</code></pre>


<p>Meaning, when running QUnit tests via PhantomJS, the output of any <code>console.log</code> statements will appear on the command line.</p>

<h3>QUnit</h3>

<p>QUnit provides a <a href="http://api.qunitjs.com/">comprehensive API</a> including <a href="http://api.qunitjs.com/category/callbacks/">callback hooks</a> for common tasks such as tests starting and finishing.  This is perfect for logging information about the tests themselves.</p>

<p>For example you could use the following to log the associated message for every test that fails:</p>

<pre class="language-javascript"><code>
QUnit.log(function(details) {
    if (!details.result) {
        console.log(details.message);
    }
});
</code></pre>


<p>If we apply this our failing test suite we now get the following:</p>

<pre class="language-shell"><code>tj-mac:spinner tj3$ phantomjs run-qunit.js spinner.html
min from markup
stop from options
blur after many keys
'waitFor()' finished in 579ms.
Tests completed in 483 milliseconds.
486 tests of 489 passed, 3 failed.
</code></pre>


<p>Better, but still not terribly useful.  In order to provide a useful report of failed tests you need to combine more of QUnit&#8217;s API callbacks with some basic text formatting.  Here&#8217;s a more comprehensive example:</p>

<pre class="language-javascript"><code>
(function() {
    var module = '', 
        test = '',
        lastModuleLogged = '',
        lastTestLogged = '',
        failuresOnCurrentTest = 0,
        failureFound = false;

    QUnit.moduleStart(function(details) {
        module = details.name;
    });
    QUnit.testStart(function(details) {
        test = details.name;
    });

    QUnit.log(function(details) {
        if (!details.result) {
            if (!failureFound) {
                failureFound = true;
                console.log('');
                console.log('/*********************************************************************/');
                console.log('/************************** FAILURE SUMMARY **************************/');
                console.log('/*********************************************************************/');
            }

            if (lastModuleLogged != module) {
                console.log('');
                console.log('-----------------------------------------------------------------------');
                console.log('Module: ' + module);
            }

            if (lastTestLogged != test) {
                failuresOnCurrentTest = 1;
                console.log('-----------------------------------------------------------------------');
                console.log('Test: ' + test);
            } else {
                failuresOnCurrentTest++;
            }

            console.log(' ' + failuresOnCurrentTest + ') Message: ' + details.message);
            if (typeof details.expected !== 'undefined') {
                console.log('    Expected: ' + details.expected);
                console.log('    Actual: ' + details.actual);
            }
            if (typeof details.source !== 'undefined') {
                console.log('    Source: ' + details.source);
            }

            lastModuleLogged = module;
            lastTestLogged = test;
        }
    });

    QUnit.done(function(details) {
        if (details.failed > 0) {
            console.log('-----------------------------------------------------------------------');
            console.log('');
        }
    });
}());
</code></pre>


<p>Now running tests with failures will produce something like the following:</p>

<pre class="language-shell"><code>tj-cpu:spinner tj$ phantomjs run-qunit.js spinner.html

/*********************************************************************/
/************************** FAILURE SUMMARY **************************/
/*********************************************************************/

-----------------------------------------------------------------------
Module: spinner: core
-----------------------------------------------------------------------
Test: reading HTML5 attributes
 1) Message: min from markup
    Expected: -1000
    Actual: -100
    Source:     at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:447
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/unit/spinner/spinner_core.js:137
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:134
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:277
    at process (file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:1233)
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:376
 2) Message: stop from options
    Expected: 50
    Actual: 5
    Source:     at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:447
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/unit/spinner/spinner_core.js:148
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:134
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:277
    at process (file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:1233)
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:376

-----------------------------------------------------------------------
Module: spinner: events
-----------------------------------------------------------------------
Test: change
 1) Message: blur after many keys
    Source:     at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:426
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/unit/spinner/spinner_events.js:130
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/ui/jquery.ui.widget.js:454
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/ui/jquery.ui.spinner.js:109
    at handlerProxy (file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/ui/jquery.ui.widget.js:371)
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/jquery-1.8.0.js:3061
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/jquery-1.8.0.js:2677
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/jquery-1.8.0.js:2941
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/jquery-1.8.0.js:3607
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/jquery-1.8.0.js:611
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/jquery-1.8.0.js:241
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/jquery-1.8.0.js:3608
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/jquery-1.8.0.js:3660
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/tests/unit/spinner/spinner_events.js:165
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:134
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:277
    at process (file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:1233)
    at file:///Applications/XAMPP/xamppfiles/htdocs/jquery/jquery-ui/external/qunit.js:376
-----------------------------------------------------------------------

'waitFor()' finished in 590ms.
Tests completed in 494 milliseconds.
486 tests of 489 passed, 3 failed.
</code></pre>


<p>This might be a bit excessive for some but I like being able to quickly see information about what failed from the command line.  Feel free to use this and alter it to your liking.</p>

<h3>TAP Format</h3>

<p>If you want to output the test results in <a href="http://en.wikipedia.org/wiki/Test_Anything_Protocol">TAP format</a> the <a href="https://github.com/twada/qunit-tap">QUnit-tap</a> plugin provides an excellent implementation using the same approach described above.</p>

<h3>Update (August 31st, 2012)</h3>

<div class='embed tweet'><blockquote class="twitter-tweet"><p><a href="https://twitter.com/tjvantoll">@tjvantoll</a> did you try the phantomjs addon? <a href="https://t.co/6Orpiwda">https://t.co/6Orpiwda</a></p>&mdash; QUnit (@qunitjs) <a href="https://twitter.com/qunitjs/statuses/240049283997503488">August 27, 2012</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div>


<p>QUnit provides its own <a href="https://github.com/jquery/qunit/tree/master/addons/phantomjs">test runner for use with PhantomJS</a> which logs information on the test run using its own APIs.</p>

<p>One difference with doing the logging in the runner rather than in the HTML is that you will not get the console logging when you run the tests in the browser, which is usually what you want.</p>

<p>Either approach can be used and customized to provide the logging you&#8217;d like.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span itemprop="name" class="fn">TJ VanToll</span></span>

      








  


<time datetime="2012-08-22T00:00:00-04:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/javascript/'>JavaScript</a>, <a class='category' href='/blog/categories/qunit/'>QUnit</a>, <a class='category' href='/blog/categories/unit-testing/'>Unit Testing</a>
  
</span>


    </p>
    <p class="author_card meta">
      <img src="/images/me/1.jpg" alt="Me!" id="post_me">
      TJ VanToll is a developer advocate for <a href="http://telerik.com">Telerik</a>, a <a href="http://jqueryui.com/about/">jQuery team member</a>, and the author of <a href="http://tjvantoll.com/jquery-ui-in-action.html">jQuery UI in Action</a>. TJ has over a decade of web development experience—specializing in performance and the mobile web—and <a href="/speaking">speaks</a> about his research at conferences around the world.TJ is <a href="http://twitter.com/tjvantoll">@tjvantoll</a> on Twitter and <a href="https://plus.google.com/+TJVanToll?rel=author" rel="author">+TJVanToll</a> on Google+.
    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tjvantoll.com/2012/08/22/logging-test-failures-in-a-phantomjs-qunit-runner/" data-via="tjvantoll" data-counturl="http://tjvantoll.com/2012/08/22/logging-test-failures-in-a-phantomjs-qunit-runner/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/08/19/onscroll-event-issues-on-mobile-browsers/" title="Previous Post: onscroll Event Issues on Mobile Browsers">&laquo; onscroll Event Issues on Mobile Browsers</a>
      
      
        <a class="basic-alignment right" href="/2012/08/28/google-analytics-excluding-visits-in-development-and-production/" title="Next Post: Google Analytics - Excluding Your Own Visits in Development and Production">Google Analytics - Excluding Your Own Visits in Development and Production &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1 id="comments">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section class="ad-section">
	<h1>Support the Site</h1>
	<div class="ad-container">
		<script defer async src="http://cdn.adpacks.com/adpacks.js?legacyid=1285803&zoneid=1386&key=cb7a6f705dfe7532dde49b4c2c5adf2d&serve=C6SI42Y&placement=tjvantollcom&circle=dev" id="_adpacks_js"></script>
	</div>
</section><section class="ad-section">
	<h1>Check Out My Book</h1> 
	<div id="book-section">
		<a href="/jquery-ui-in-action.html" class="image-link">
			<img src="/images/book.jpg" alt="My jQuery UI in Action cover">
		</a>
		<div>
			<a href="/jquery-ui-in-action.html" class="text_link">
				jQuery UI in Action<br>
			</a>
			<strong>Covers jQuery UI 1.11!</strong>
			<p>Published by <a href="http://www.manning.com/?a_aid=tj-vantoll">Manning</a>.</p>
		</div>
	</div>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2015/06/05/nativescript-showing-and-hiding-elements/">NativeScript Quick Tip: Showing and Hiding Elements</a>
      </li>
    
      <li class="post">
        <a href="/2015/05/22/linting-javascript-in-nativescript-apps/">Linting JavaScript in NativeScript Apps</a>
      </li>
    
      <li class="post">
        <a href="/2015/03/19/nativescript-ios-navigation-bars/">NativeScript Quick Tip: Managing iOS Navigation Bars</a>
      </li>
    
      <li class="post">
        <a href="/2015/01/28/reportvalidity/">A reportValidity() Use Case and Polyfill</a>
      </li>
    
      <li class="post">
        <a href="/2015/01/26/wkwebview-plugin/">Speed Up Your Cordova App with the WKWebView Plugin</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - <a href="/">TJ VanToll</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tjvantoll';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://tjvantoll.com/2012/08/22/logging-test-failures-in-a-phantomjs-qunit-runner/';
        var disqus_url = 'http://tjvantoll.com/2012/08/22/logging-test-failures-in-a-phantomjs-qunit-runner/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




Included file 'google_plus_one.html' not found in _includes directory

  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


Included file 'custom/after_footer.html' not found in _includes directory

</body>
</html>
