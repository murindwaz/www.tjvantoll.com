
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Detecting Print Requests with JavaScript - TJ VanToll's Blog - Tutorials, Thoughts, and Ramblings on Front-End Development</title>
  <meta name="author" content="TJ VanToll">

  
  <meta name="description" content="CSS has a well supported mechanism for applying changes only when the user is printing a document, print stylesheets. They allow you to alter the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tjvantoll.com/2012/06/15/detecting-print-requests-with-javascript">
  <link rel="author" href="https://plus.google.com/+TJVanToll">

  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
  
  <!--Custom script concatenation
  <script src="/javascripts/modernizr-2.5.3.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js"></script>
  <script src="/javascripts/PictureCube.js"></script>
  <script src="/javascripts/blog.js"></script>
  -->
  <script src="/javascripts/build/scripts.js"></script>

  <link href="/atom.xml" rel="alternate" title="TJ VanToll's Blog" type="application/atom+xml">
  
  <script type="text/javascript">
  	if (window.location.host.indexOf('local') == -1) {
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-29179796-1']);
	    _gaq.push(['_trackPageview']);
	
	    (function() {
	      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	    })();
    }
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
	<h1><a href="/">TJ VanToll's Blog</a></h1>
	
		<h2>Tutorials, Thoughts, and Ramblings on Front-End Development</h2> 
	
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tjvantoll.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
<li><a href="/">About</a></li>
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="/speaking/">Speaking</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article itemscope itemtype="http://schema.org/BlogPosting" role="article">
  
  <header>
    
      <h1 class="entry-title" itemprop="name headline">Detecting Print Requests with JavaScript</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-15T00:00:00-04:00" pubdate data-updated="true">Jun 15<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>CSS has a well supported mechanism for applying changes only when the user is printing a document, <a href="http://coding.smashingmagazine.com/2011/11/24/how-to-set-up-a-print-style-sheet/">print stylesheets</a>.  They allow you to alter the presentation of a web page for the printer by applying rules that will only be interpreted for printing.  This is great for common tasks like hiding non-essential content, using more print friendly typography, and adjusting the layout to better suit the size and shape of paper.</p>

<p>Print stylesheets are great for making presentational changes for printing, but sometimes you need the full power of JavaScript.  And in order to do respond to print requests in JavaScript you need the browser to notify you that a print request occurred.</p>

<!--more-->


<h3>onbeforeprint and onafterprint</h3>

<p>IE5+ fires <code>onbeforeprint</code> and <code>onafterprint</code> events before and after the user requests the page to be printed.</p>

<pre class="language-javascript"><code>
window.onbeforeprint = function() {
    console.log('This will be called before the user prints.');
};
window.onafterprint = function() {
    console.log('This will be called after the user prints');   
};
</code></pre>


<p>These events are not part of any specification but they are very convenient.  Because of this <a href="https://developer.mozilla.org/en/DOM/window.onbeforeprint#Browser_compatibility">Firefox added support for both events in version 6</a>.  However, WebKit and Opera do not support the events.  Therefore, for cross browser compatibility these events aren&#8217;t going to cut it.</p>

<h3>WebKit&#8217;s Solution</h3>

<p>WebKit has a bug (#<a href="https://bugs.webkit.org/show_bug.cgi?id=19937">19937</a>) out there to implement these events, but progress has stopped because the implementation of another API made this functionality possible already - <code>window.matchMedia</code>.</p>

<h3>window.matchMedia</h3>

<p>The <code>window.matchMedia</code> <a href="https://developer.mozilla.org/en/DOM/window.matchMedia">API</a> provides a means of determining whether the current <code>document</code> matches a given <a href="https://developer.mozilla.org/En/CSS/Media_queries">media query</a>.  For example:</p>

<pre class="language-javascript"><code>
if (window.matchMedia(' (min-width: 600px) ').matches) {  
    console.log('The viewport is at least 600 pixels wide');
} else { 
    console.log('The viewport is less than 600 pixels wide');
} 
</code></pre>


<p>You can also use this API to add listeners that will be fired whenever the result of the media query changes.  In the above example the <code>matches</code> criteria will be met whenever the viewport is at least 600px wide.  If you wanted to receive notifications whenever the viewport crossed the 600px threshold you could use the following.</p>

<pre class="language-javascript"><code>
var mediaQueryList = window.matchMedia(' (min-width: 600px) ');
mediaQueryList.addListener(function(mql) {
    if (mql.matches) {
        console.log('The viewport is at least 600 pixels wide');
    } else {
        console.log('The viewport is less than 600 pixels wide');
    }
});
</code></pre>


<p><a href="http://caniuse.com/#feat=matchmedia">If your browser supports window.matchMedia</a> you can see this behavior live below by resizing your browser window under 600px on the following demo:</p>

<div class="code_example"><h6>matchMedia Example<a href="/demos/2012-06-15/matchMedia-example.html" target="_blank">Open in New Window</a></h6><iframe style="width: 100%; height: 200px;" frameborder="0" src="/demos/2012-06-15/matchMedia-example.html"></iframe></div>


<p>Interestingly, it turns out you can also use this same technique to listen for the <code>print</code> media being applied when the user requests the document to be printed (<a href="http://code.google.com/p/chromium/issues/detail?id=105743">hat tip to Ben Wells</a>):</p>

<pre class="language-javascript"><code>
var mediaQueryList = window.matchMedia('print');
mediaQueryList.addListener(function(mql) {
    if (mql.matches) {
        console.log('onbeforeprint equivalent');
    } else {
        console.log('onafterprint equivalent');
    }
});
</code></pre>


<p>This works great in Chrome 9+ and Safari 5.1 (with the exception of the fact that the <a href="http://code.google.com/p/chromium/issues/detail?id=105743">listeners fire twice in Chrome</a>).  However, it doesn&#8217;t work in Firefox or IE10, even though they both support <code>window.matchMedia</code>.</p>

<h4>Update (July 16th, 2012)</h4>

<p>I created a bug on Firefox&#8217;s issue tracker for this defect - <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=774398">https://bugzilla.mozilla.org/show_bug.cgi?id=774398</a>.  I&#8217;ll update this post when I hear back.</p>

<h3>Combining the Approaches</h3>

<p>If you combine the two approaches you can detect print requests in IE 5+, Firefox 6+, Chrome 9+, and Safari 5.1+ (unfortunately Opera doesn&#8217;t support either approach).</p>

<pre class="language-javascript"><code>
(function() {
    var beforePrint = function() {
        console.log('Functionality to run before printing.');
    };
    var afterPrint = function() {
        console.log('Functionality to run after printing');
    };

    if (window.matchMedia) {
        var mediaQueryList = window.matchMedia('print');
        mediaQueryList.addListener(function(mql) {
            if (mql.matches) {
                beforePrint();
            } else {
                afterPrint();
            }
        });
    }

    window.onbeforeprint = beforePrint;
    window.onafterprint = afterPrint;
}());
</code></pre>


<p>Note that your event handlers might potentially have to deal with the fact that they&#8217;re going to be called twice per print request in Chrome.</p>

<h3>Why Would I Use This?</h3>

<p>For most situations print stylesheets are all you need to prepare the document for printing.  But I can think of a couple practical uses of the JavaScript event.</p>

<h3>Responsive Print Images</h3>

<p>One use is substituting a higher quality image for the purposes of printing.  Traditionally <a href="http://www.cssnewbie.com/print-friendly-images/">web browsers have displayed images at 72dpi and most printers can handle 300dpi+</a>.  While some newer devices are able to display images at much higher resolutions, most users are still using a screen that will show web images at much lower resolutions than their printer can handle.</p>

<p>Therefore an image that might look just fine on the user&#8217;s screen might look fuzzy and grainy when printed out.  For most images this is acceptable, but it might be an issue for prominent images on regularly printed documents, like a company logo.  You probably want that to look crisp when printed out.</p>

<p>The <a href="http://www.alistapart.com/articles/hiresprinting">technique to work around this</a> involves loading both images, showing only the lower quality one by default, then hiding the low quality image and showing the high quality one in the print stylesheet.  The main downfall of this approach is that the end user has to download both images regardless of whether they&#8217;re going to print the page.  Users on 3G devices that have no intention or capability of printing the document will still have to download your high resolution logo.</p>

<p>With the ability to detect print requests in JavaScript you can substitute the higher quality image on the fly when the user requests the page to be printed.</p>

<pre class="language-markup"><code>
&lt;img src="low-quality.jpg" id="company_logo" alt="My Company" /&gt;

&lt;script&gt;
    (function() {
        var upgradeImage = function() {
            document.getElementById('company_logo')
                .setAttribute('src', 'high-quality.png'); 
        };

        if (window.matchMedia) {
            var mediaQueryList = window.matchMedia('print');
            mediaQueryList.addListener(upgradeImage);
        }

        window.onbeforeprint = upgradeImage;
    });
&lt;/script&gt;
</code></pre>


<p>The nice thing about this approach is that users that never print will not have to download the high quality image.  This technique also degrades nicely; users with browsers that don&#8217;t support the print events will simply print the lower quality image.</p>

<h3>Tracking Print Requests</h3>

<p>Print events can also be used to track the number of times users print pages within a site or application.  Because of the lack of total browser support you wouldn&#8217;t capture every print request, but this would be sufficient for getting a rough idea of how often people are printing.</p>

<pre class="language-javascript line-numbers"><code>(function() {
    var afterPrint = function() {
        // Here you would send an AJAX request to the server to track that a page
        // has been printed.  You could additionally pass the URL if you wanted to
        // track printing across an entire site or application.
    };

    if (window.matchMedia) {
        var mediaQueryList = window.matchMedia('print');
        mediaQueryList.addListener(function(mql) {
            if (!mql.matches) {
                afterPrint();
            }
        });
    }

    window.onafterprint = afterPrint;
}());</code></pre>


<h3>So can I use this in a &#8220;real&#8221; application?</h3>

<p>Sure, just make sure what you&#8217;re doing degrades nicely for users using a browser in which the event will not be fired.</p>

<p>Can you think of any other practical uses of detecting print requests in JavaScript?  If so let me know in the comments.</p>

<h4>Update (July 16th, 2012)</h4>

<p>Per the comments I&#8217;ve found that in addition to all the bugs mentioned above, certain browsers trigger the after print event early (with either <code>onafterprint</code> or the <code>window.matchMedia</code> handler implementation).</p>

<pre class="language-markup line-numbers"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;script&gt;
            var beforePrint = function() {
                document.getElementById('printImage').src = 
                    'http://stackoverflow.com/favicon.ico';
            };
            var afterPrint = function() {
                document.getElementById('printImage').src = 
                    'http://google.com/favicon.ico';
            };

            if (window.matchMedia) {
                var mediaQueryList = window.matchMedia('print');
                mediaQueryList.addListener(function(mql) {
                    if (mql.matches) {
                        beforePrint();
                    } else {
                        afterPrint();
                    }
                });
            }

            window.onbeforeprint = beforePrint;
            window.onafterprint = afterPrint;
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;img id="printImage" src="http://google.com/favicon.ico" /&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>


<p>When printing the above document you would expect Stack Overflow&#8217;s favicon to print, when in actuality Google&#8217;s favicon prints.  Both events fire, but the after print event fires before the printing actually occurs, which in this case reverts the changes made in the before print event.</p>

<p>I was able to recreate this problem in Chrome and Firefox.</p>

<p>Therefore do not do anything that relies on the after print event to fix what the before print event did.  For responsive print images this shouldn&#8217;t be an issue because there should be no harm leaving the higher quality image in place; the user has already downloaded it.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span itemprop="name" class="fn">TJ VanToll</span></span>

      








  


<time datetime="2012-06-15T00:00:00-04:00" pubdate data-updated="true">Jun 15<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/browsers/'>Browsers</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript</a>
  
</span>


    </p>
    <p class="author_card meta">
      <img src="/images/me/1.jpg" alt="Me!" id="post_me">
      TJ VanToll is a developer advocate for <a href="http://telerik.com">Telerik</a>, a <a href="http://jqueryui.com/about/">jQuery team member</a>, and the author of <a href="http://tjvantoll.com/jquery-ui-in-action.html">jQuery UI in Action</a>. TJ has over a decade of web development experience—specializing in performance and the mobile web—and <a href="/speaking">speaks</a> about his research at conferences around the world.TJ is <a href="http://twitter.com/tjvantoll">@tjvantoll</a> on Twitter and <a href="https://plus.google.com/+TJVanToll?rel=author" rel="author">+TJVanToll</a> on Google+.
    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tjvantoll.com/2012/06/15/detecting-print-requests-with-javascript/" data-via="tjvantoll" data-counturl="http://tjvantoll.com/2012/06/15/detecting-print-requests-with-javascript/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/06/10/browser-css-parsing-discrepancies/" title="Previous Post: Browser CSS Parsing Discrepancies">&laquo; Browser CSS Parsing Discrepancies</a>
      
      
        <a class="basic-alignment right" href="/2012/06/30/creating-a-native-html5-datepicker-with-a-fallback-to-jquery-ui/" title="Next Post: Creating a Native HTML 5 Datepicker with a Fallback to jQuery UI">Creating a Native HTML 5 Datepicker with a Fallback to jQuery UI &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1 id="comments">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section class="ad-section">
	<h1>Support the Site</h1>
	<div class="ad-container">
		<script defer async src="http://cdn.adpacks.com/adpacks.js?legacyid=1285803&zoneid=1386&key=cb7a6f705dfe7532dde49b4c2c5adf2d&serve=C6SI42Y&placement=tjvantollcom&circle=dev" id="_adpacks_js"></script>
	</div>
</section><section class="ad-section">
	<h1>Check Out My Book</h1> 
	<div id="book-section">
		<a href="/jquery-ui-in-action.html" class="image-link">
			<img src="/images/book.jpg" alt="My jQuery UI in Action cover">
		</a>
		<div>
			<a href="/jquery-ui-in-action.html" class="text_link">
				jQuery UI in Action<br>
			</a>
			<strong>Covers jQuery UI 1.11!</strong>
			<p>Published by <a href="http://www.manning.com/?a_aid=tj-vantoll">Manning</a>.</p>
		</div>
	</div>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2015/06/05/nativescript-showing-and-hiding-elements/">NativeScript Quick Tip: Showing and Hiding Elements</a>
      </li>
    
      <li class="post">
        <a href="/2015/05/22/linting-javascript-in-nativescript-apps/">Linting JavaScript in NativeScript Apps</a>
      </li>
    
      <li class="post">
        <a href="/2015/03/19/nativescript-ios-navigation-bars/">NativeScript Quick Tip: Managing iOS Navigation Bars</a>
      </li>
    
      <li class="post">
        <a href="/2015/01/28/reportvalidity/">A reportValidity() Use Case and Polyfill</a>
      </li>
    
      <li class="post">
        <a href="/2015/01/26/wkwebview-plugin/">Speed Up Your Cordova App with the WKWebView Plugin</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - <a href="/">TJ VanToll</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tjvantoll';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://tjvantoll.com/2012/06/15/detecting-print-requests-with-javascript/';
        var disqus_url = 'http://tjvantoll.com/2012/06/15/detecting-print-requests-with-javascript/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




Included file 'google_plus_one.html' not found in _includes directory

  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


Included file 'custom/after_footer.html' not found in _includes directory

</body>
</html>
