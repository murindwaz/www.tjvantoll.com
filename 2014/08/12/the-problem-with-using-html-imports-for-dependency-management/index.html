
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The Problem With Using HTML Imports For Dependency Management - TJ VanToll's Blog - Tutorials, Thoughts, and Ramblings on Front-End Development</title>
  <meta name="author" content="TJ VanToll">

  
  <meta name="description" content="HTML imports are cool. If you haven&#8217;t heard of them before, you should read Eric Bidelman&#8217;s excellent introduction to them, but they&# &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tjvantoll.com/2014/08/12/the-problem-with-using-html-imports-for-dependency-management">
  <link rel="author" href="https://plus.google.com/+TJVanToll">

  <!--[if !lte IE 7]><!-->
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
  <!--<![endif]-->
  <!--[if lte IE 7]>
    <link rel="stylesheet" href="/stylesheets/old-ie.css" media="screen, projection">
  <![endif]-->
  
  <!--Custom script concatenation
  <script src="/javascripts/modernizr-2.5.3.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js"></script>
  <script src="/javascripts/PictureCube.js"></script>
  <script src="/javascripts/blog.js"></script>
  -->
  <script src="/javascripts/build/scripts.js"></script>

  <link href="/atom.xml" rel="alternate" title="TJ VanToll's Blog" type="application/atom+xml">
  <style>
	/* Fonts from Google"s Web font directory at http://google.com/webfonts */
	/*@import url(http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic);
	@import url(http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic);*/
</style>

  
  <script type="text/javascript">
  	if (window.location.host.indexOf('local') == -1) {
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-29179796-1']);
	    _gaq.push(['_trackPageview']);
	
	    (function() {
	      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	    })();
    }
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
	<h1><a href="/">TJ VanToll's Blog</a></h1>
	
		<h2>Tutorials, Thoughts, and Ramblings on Front-End Development</h2> 
	
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tjvantoll.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
<li><a href="/">About</a></li>
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="/speaking/">Speaking</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article itemscope itemtype="http://schema.org/BlogPosting" role="article">
  
  <header>
    
      <h1 class="entry-title" itemprop="name headline">The Problem With Using HTML Imports For Dependency Management</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-12T00:00:00-04:00" pubdate data-updated="true">Aug 12<span>th</span>, 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>HTML imports are cool. If you haven&#8217;t heard of them before, you should read <a href="http://www.html5rocks.com/en/tutorials/webcomponents/imports/">Eric Bidelman&#8217;s excellent introduction to them</a>, but they&#8217;re pretty self explanatory with a bit of code. For example the following is how a jQuery UI dialog works in <a href="https://github.com/tjvantoll/ui-web-components">my proof-of-concept web components port</a>:</p>

<figure class='code'><figcaption class='empty'><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;import&quot;</span> <span class="na">href=</span><span class="s">&quot;ui-dialog.html&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;ui</span><span class="na">-dialog</span> <span class="na">title=</span><span class="s">&quot;Hello World&quot;</span><span class="nt">&gt;</span><span class="err">&lt;</span>/ui-dialog&gt;
</span></code></pre></td></tr></table></div></figure>


<p>The cool thing here is not what you see—a <code>&lt;link&gt;</code> tag that imports a custom element—but rather, what you don&#8217;t. Normally when using jQuery UI widgets, you have to worry about a number of JavaScript and CSS dependencies, such as jQuery Core, the widget factory, a CSS theme, and more. With HTML imports you don&#8217;t, as the import takes care of bundling everything you need.</p>

<!--more-->


<h3>OMG Awesome! What&#8217;s the problem?</h3>

<p>HTML imports transfer the dependency management burden from component consumers to component authors. This sounds good, until you think about <em>how</em> to reconcile those dependencies.</p>

<p>Suppose you want to write a component that depends on jQuery. How might you do that? Well, the easiest way is to package jquery.js within your web component, and to reference it in your HTML import with a simple <code>&lt;script&gt;</code> tag:</p>

<figure class='code'><figcaption class='empty'><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;jquery.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This works, and is simple, but it has a serious repercussion: jquery.js is bundled with your component. That means, with this approach, if a user imports five jQuery-dependent components, the browser will download jQuery five times. And because reducing HTTP requests is a vital web performance optimization, this is <a href="https://www.youtube.com/watch?v=H8OxKx6zKkQ">kind of a big deal</a>.</p>

<h3>What about de-duping?</h3>

<p>De-duping, besides being an awesome word to say, is a mechanism built into HTML imports to prevent multiple requests for the same resource. That is, if multiple imports reference the same URL, the browser is smart enough to only retrieve the resource once.</p>

<p>The problem is the de-duping mechanism only works on <em>exact</em> URL matches. Different domains, different protocols, different versions, and so forth are each enough to subvert the de-duping process.</p>

<p>The crux of the issue is that dependencies in HTML imports aren&#8217;t strings like &#8220;jquery&#8221; and &#8220;bootstrap&#8221;, they&#8217;re URLs like &#8220;http://code.jquery.com/jquery-2.1.1.min.js&#8221; and &#8220;http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js&#8221;—and there&#8217;s no way of knowing what the consumer of the component expects.</p>

<p>What&#8217;s an HTML import with external dependencies to do? <a href="http://www.polymer-project.org/resources/faq.html#loadlibs">Polymer&#8217;s documentation</a> gives the following recommendation in its FAQ:</p>

<blockquote><p>&#8220;If multiple libraries want to share a dependency, they will have to agree on a system. Feature detection, or an agreed upon common location for a ‘jquery.html’ file in a CDN, etc.&#8221;</p></blockquote>

<p>Getting libraries to agree on <em>anything</em> in the web world has been painfully difficult, but it&#8217;s definitely worth a discussion. Let&#8217;s look at each of these options in detail.</p>

<h3>Options for managing external dependencies</h3>

<p>To discuss our options, let&#8217;s suppose that you want to build a hypothetical <code>&lt;formatted-time&gt;</code> custom element as an HTML import, and you want to use <a href="http://momentjs.com/">Moment.js</a> as part of your implementation.</p>

<p>Assuming that you don&#8217;t package Moment.js as part of your component, and we&#8217;ve already seen why that&#8217;s a bad idea, here are your options:</p>

<h4>Option 1: Use a CDN</h4>

<p>You could refer to Moment.js on some CDN, for instance the following <code>&lt;script&gt;</code> tag imports Moment.js from <a href="http://cdnjs.com/">cdnjs</a>:</p>

<figure class='code'><figcaption class='empty'><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This approach works, but it has some major disadvantages. For one, the CDN approach only prevents multiple downloads of Moment.js if everyone magically chooses to retrieve Moment.js from the exact same URL—same CDN provider, same protocol, same version, and so forth. Second, the CDN reference also prevents the usage of script concatenation tooling, which is an essential performance optimization, especially for mobile. Because of this, I don&#8217;t see CDNs as a viable option for managing external dependencies.</p>

<h4>Option 2: Enforce a folder structure</h4>

<p>The next option you have is enforcing a specific directory structure on the consumer of your component. For instance, you could enforce that users have a folder structure that looks like this:</p>

<figure class='code'><figcaption class='empty'><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>.
</span><span class='line'>├── momentjs
</span><span class='line'>│   └── moment.js
</span><span class='line'>└── formatted-time
</span><span class='line'>    └── formatted-time.html
</span></code></pre></td></tr></table></div></figure>


<p>With this structure in place, your formatted-time.html file can reference moment.js using <code>&lt;link rel="import" href="../momentjs/moment.js"&gt;</code>. This is the strategy Polymer itself uses, as all Polymer core elements include an import of <code>&lt;link rel="import" href="../polymer/polymer.html"&gt;</code> to get the dependencies they need.</p>

<p>This approach works well if your users manage their dependencies through a package manager such as Bower, as the package manager provides a defined structure you can rely on. But the reality is only a small fraction of the web uses Bower, and the developers that do often have build scripts in place to move files to locations that their servers and development environments require.</p>

<p>Enforcing a directory structure for dependencies can theoretically work, but it requires the community to agree on and standardize a directory structure to use, which is a tall task.</p>

<p>Worse, even agreeing on a directory structure isn&#8217;t enough, as the exact file paths must match to prevent multiple downloads. If component A references <code>"../momentjs/moment.js"</code>, and component B references <code>"../momentjs/min/moment.min.js"</code>, the browser sees two different resources that need to be individually downloaded.</p>

<h4>Option 3: Feature detection</h4>

<p>The next option is feature detection, or determining whether your dependency has already been loaded, and if not, loading it yourself. For example, with the <code>&lt;formatted-time&gt;</code> element you could use the following code to load conditionally load Moment.js:</p>

<figure class='code'><figcaption class='empty'><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">script</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">moment</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span> <span class="s2">&quot;script&quot;</span> <span class="p">);</span>
</span><span class='line'>          <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;path/to/formatted-time/moment.js&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">script</span> <span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}());</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><strong>Update August 13th, 2014</strong>—As is, this code is not enough to prevent loading Moment.js multiple times, as two modules could request the script before it has been asynchronously fetched and parsed. To avoid multiple requests correctly you&#8217;d need to <a href="#comment-1540666406">additionally add some boolean logic</a>. Thanks <a href="https://twitter.com/webreflection">@webreflection</a>!</p></blockquote>

<p>This approach avoids the problem of loading Moment.js multiple times, but there&#8217;s still a major problem: the path to use for moment.js. Because you need to do a feature check, and because <code>document.write</code>s are not permitted in HTML import files, you must load feature-checked dependencies asynchronously. And when you do that, the path of the dependency is not relative to the current HTML import file; it&#8217;s relevant to the root of the application—and there&#8217;s no way of knowing what that is in a distributable component. You could use a CDN path, but that&#8217;s subject to the problems discussed in <strong>Option 1</strong>.</p>

<p>Doing a feature check also prevents the usage of HTML import build tools such as <a href="https://github.com/Polymer/vulcanize">Vulcanize</a>, which inlines all HTML import dependencies into a single file—a vital performance optimization for anyone using HTML imports in a production setting. In theory build tools like Vulcanize could help manage these dependencies in the future, but at the moment such a mechanism does not exist.</p>

<h4>Option 4: Don&#8217;t use HTML imports for external dependencies</h4>

<p>The final option you have is to avoid using HTML imports to manage external dependencies. For the <code>&lt;formatted-time&gt;</code> example, this means not referencing moment.js in your component at all; you just assume that it&#8217;s there and note that it&#8217;s a requirement in your documentation—exactly like you do today.</p>

<p>Of course, this subverts the main purpose of building an HTML import—building a self-contained module—but at the moment I don&#8217;t see a better option.</p>

<h3>Where to go from here?</h3>

<p>I don&#8217;t have the solution, but I think we need to be having this discussion if we want to see high quality HTML imports that don&#8217;t have negative performance consequences. I&#8217;d love to hear your thoughts on this in the comments.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span itemprop="name" class="fn">TJ VanToll</span></span>

      








  


<time datetime="2014-08-12T00:00:00-04:00" pubdate data-updated="true">Aug 12<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/web-components/'>Web Components</a>
  
</span>


    </p>
    <p class="author_card meta">
      <img src="/images/me/1.jpg" alt="Me!" id="post_me">
      TJ VanToll is a developer advocate for <a href="http://telerik.com">Telerik</a>, a <a href="http://jqueryui.com/about/">jQuery team member</a>, and the author of <a href="http://tjvantoll.com/jquery-ui-in-action.html">jQuery UI in Action</a>. TJ has over a decade of web development experience—specializing in performance and the mobile web—and <a href="/speaking">speaks</a> about his research at conferences around the world. When not online, TJ is generally found talking about himself in the third person. If you like hearing TJ talk about himself, you should consider following him on <a href="http://twitter.com/tjvantoll">Twitter</a> or <a href="https://plus.google.com/+TJVanToll?rel=author" rel="author">Google+</a>.
    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tjvantoll.com/2014/08/12/the-problem-with-using-html-imports-for-dependency-management/" data-via="tjvantoll" data-counturl="http://tjvantoll.com/2014/08/12/the-problem-with-using-html-imports-for-dependency-management/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2014/07/25/building-a-phonegap-app-in-10-seconds-using-nothing-but-a-cli/" title="Previous Post: Building a PhoneGap App in 10 Seconds Using Nothing But a CLI">&laquo; Building a PhoneGap App in 10 Seconds Using Nothing But a CLI</a>
      
      
        <a class="basic-alignment right" href="/2014/12/29/so-you-want-to-write-a-tech-book/" title="Next Post: So You Want to Write a Tech Book">So You Want to Write a Tech Book &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1 id="comments">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section class="ad-section">
	<h1>Support the Site</h1>
	<div class="ad-container">
		<script defer async src="http://cdn.adpacks.com/adpacks.js?legacyid=1285803&zoneid=1386&key=cb7a6f705dfe7532dde49b4c2c5adf2d&serve=C6SI42Y&placement=tjvantollcom&circle=dev" id="_adpacks_js"></script>
	</div>
</section><section class="ad-section">
	<h1>Check Out My Book</h1> 
	<div id="book-section">
		<a href="/jquery-ui-in-action.html" class="image-link">
			<img src="/images/book.jpg" alt="My jQuery UI in Action cover">
		</a>
		<div>
			<a href="/jquery-ui-in-action.html" class="text_link">
				jQuery UI in Action<br>
			</a>
			<strong>Covers jQuery UI 1.11!</strong>
			<p>Published by <a href="http://www.manning.com/?a_aid=tj-vantoll">Manning</a>.</p>
		</div>
	</div>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2015/05/22/linting-javascript-in-nativescript-apps/">Linting JavaScript in NativeScript Apps</a>
      </li>
    
      <li class="post">
        <a href="/2015/03/19/nativescript-ios-navigation-bars/">NativeScript Quick Tip: Managing iOS Navigation Bars</a>
      </li>
    
      <li class="post">
        <a href="/2015/01/28/reportvalidity/">A reportValidity() Use Case and Polyfill</a>
      </li>
    
      <li class="post">
        <a href="/2015/01/26/wkwebview-plugin/">Speed Up Your Cordova App with the WKWebView Plugin</a>
      </li>
    
      <li class="post">
        <a href="/2015/01/18/getting-started-with-kendo-ui-core/">Getting Started with Kendo UI Core</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - <a href="/">TJ VanToll</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tjvantoll';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://tjvantoll.com/2014/08/12/the-problem-with-using-html-imports-for-dependency-management/';
        var disqus_url = 'http://tjvantoll.com/2014/08/12/the-problem-with-using-html-imports-for-dependency-management/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
